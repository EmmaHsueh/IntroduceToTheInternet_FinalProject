{"ast":null,"code":"// src/services/postService.js\n// é€™å€‹æª”æ¡ˆå°ˆé–€è™•ç†è²¼æ–‡ç›¸é—œçš„ Firestore æ“ä½œ\n\nimport { collection,\n// ç”¨ä¾†æŒ‡å®šé›†åˆ\naddDoc,\n// æ–°å¢æ–‡ä»¶\ngetDocs,\n// å–å¾—æ‰€æœ‰æ–‡ä»¶ï¼ˆä¸€æ¬¡æ€§ï¼‰\ngetDoc,\n// ğŸ”¥ æ–°å¢ï¼šå–å¾—å–®ä¸€æ–‡ä»¶\nquery,\n// å»ºç«‹æŸ¥è©¢\nwhere,\n// æŸ¥è©¢æ¢ä»¶\norderBy,\n// æ’åº\nonSnapshot,\n// å³æ™‚ç›£è½è³‡æ–™è®ŠåŒ–\ndoc,\n// æŒ‡å®šç‰¹å®šæ–‡ä»¶\nupdateDoc,\n// æ›´æ–°æ–‡ä»¶\nTimestamp // Firestore æ™‚é–“æˆ³è¨˜\n} from 'firebase/firestore';\nimport { db } from '../firebase';\n\n// ==========================================\n// ğŸ“– åŸç†è§£èªªï¼š\n// ==========================================\n// Firestore çš„æ ¸å¿ƒæ“ä½œåˆ†ç‚ºå…©ç¨®ï¼š\n// 1. ã€Œä¸€æ¬¡æ€§è®€å–ã€ï¼šgetDocs() - åªå–å¾—ç•¶ä¸‹çš„è³‡æ–™\n// 2. ã€Œå³æ™‚ç›£è½ã€ï¼šonSnapshot() - è³‡æ–™æœ‰è®ŠåŒ–æ™‚è‡ªå‹•æ›´æ–°\n\n// æˆ‘å€‘æœƒä½¿ç”¨ onSnapshot()ï¼Œé€™æ¨£ç•¶å…¶ä»–ç”¨æˆ¶ç™¼æ–‡æ™‚\n// ä½ çš„ç•«é¢æœƒè‡ªå‹•å³æ™‚æ›´æ–°ï¼\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 1ï¼šå–å¾—æŒ‡å®šçœ‹æ¿çš„æ‰€æœ‰è²¼æ–‡ï¼ˆå³æ™‚ç›£è½ï¼‰\n// ==========================================\n/**\n * ç›£è½æŒ‡å®šçœ‹æ¿çš„è²¼æ–‡ï¼Œä¸¦åœ¨è³‡æ–™è®ŠåŒ–æ™‚å³æ™‚æ›´æ–°\n *\n * @param {string} boardName - çœ‹æ¿åç¨±ï¼ˆä¾‹å¦‚ \"Food\"ï¼‰\n * @param {function} callback - ç•¶è³‡æ–™è®ŠåŒ–æ™‚æœƒå‘¼å«é€™å€‹å‡½æ•¸ï¼Œå‚³å…¥æœ€æ–°çš„è²¼æ–‡é™£åˆ—\n * @returns {function} unsubscribe - å‘¼å«é€™å€‹å‡½æ•¸å¯ä»¥åœæ­¢ç›£è½\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * const unsubscribe = listenToPosts(\"Food\", (posts) => {\n *   console.log(\"æ”¶åˆ°æœ€æ–°è²¼æ–‡:\", posts);\n *   setPosts(posts); // æ›´æ–° React state\n * });\n *\n * // ç•¶çµ„ä»¶å¸è¼‰æ™‚ï¼Œåœæ­¢ç›£è½\n * return () => unsubscribe();\n */\nexport const listenToPosts = (boardName, callback) => {\n  try {\n    // 1. å»ºç«‹å° posts collection çš„åƒç…§\n    const postsRef = collection(db, 'posts');\n\n    // 2. å»ºç«‹æŸ¥è©¢ï¼šåªå–å¾—æŒ‡å®šçœ‹æ¿çš„è²¼æ–‡ï¼Œä¸¦æŒ‰æ™‚é–“æ’åºï¼ˆæ–°çš„åœ¨å‰ï¼‰\n    const q = query(postsRef, where('boardName', '==', boardName),\n    // ç¯©é¸æ¢ä»¶ï¼šçœ‹æ¿åç¨±\n    orderBy('createdAt', 'desc') // æ’åºï¼šæœ€æ–°çš„åœ¨æœ€ä¸Šé¢\n    );\n\n    // 3. é–‹å§‹ç›£è½é€™å€‹æŸ¥è©¢\n    // ğŸ”‘ é‡é»ï¼šonSnapshot æœƒåœ¨ä»¥ä¸‹æƒ…æ³è§¸ç™¼ï¼š\n    //    - ç¬¬ä¸€æ¬¡å‘¼å«æ™‚ï¼ˆå›å‚³ç¾æœ‰è³‡æ–™ï¼‰\n    //    - æœ‰æ–°è²¼æ–‡æ–°å¢æ™‚\n    //    - æœ‰è²¼æ–‡è¢«ä¿®æ”¹æ™‚\n    //    - æœ‰è²¼æ–‡è¢«åˆªé™¤æ™‚\n    const unsubscribe = onSnapshot(q, snapshot => {\n      const posts = [];\n\n      // 4. éæ­·æ‰€æœ‰æ–‡ä»¶ï¼Œå°‡è³‡æ–™è½‰æ›æˆæˆ‘å€‘éœ€è¦çš„æ ¼å¼\n      snapshot.forEach(doc => {\n        posts.push({\n          id: doc.id,\n          // æ–‡ä»¶ ID\n          ...doc.data() // æ–‡ä»¶å…§çš„æ‰€æœ‰è³‡æ–™\n        });\n      });\n\n      // 5. å‘¼å« callbackï¼ŒæŠŠæœ€æ–°è³‡æ–™å‚³å‡ºå»\n      callback(posts);\n    }, error => {\n      console.error('ç›£è½è²¼æ–‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n      // å¦‚æœç™¼ç”ŸéŒ¯èª¤ï¼Œå›å‚³ç©ºé™£åˆ—\n      callback([]);\n    });\n\n    // 6. å›å‚³å–æ¶ˆç›£è½çš„å‡½æ•¸\n    return unsubscribe;\n  } catch (error) {\n    console.error('è¨­å®šç›£è½æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    return () => {}; // å›å‚³ç©ºå‡½æ•¸é¿å…éŒ¯èª¤\n  }\n};\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 2ï¼šæ–°å¢è²¼æ–‡åˆ° Firestore\n// ==========================================\n/**\n * æ–°å¢ä¸€ç¯‡è²¼æ–‡åˆ° Firestore\n *\n * @param {object} postData - è²¼æ–‡è³‡æ–™\n * @param {string} postData.title - æ¨™é¡Œ\n * @param {string} postData.content - å…§å®¹\n * @param {string} postData.boardName - çœ‹æ¿åç¨±\n * @param {string} postData.authorId - ä½œè€… UID\n * @param {string} postData.authorName - ä½œè€…åç¨±\n * @param {array} postData.imageUrls - åœ–ç‰‡ç¶²å€é™£åˆ—\n * @returns {Promise<string>} å›å‚³æ–°å»ºç«‹çš„æ–‡ä»¶ ID\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * const newPostId = await createPost({\n *   title: \"ç¾å‘³åˆé¤\",\n *   content: \"ä»Šå¤©åƒäº†å¥½åƒçš„æ‹‰éºµ\",\n *   boardName: \"Food\",\n *   authorId: currentUser.uid,\n *   authorName: \"å°æ˜\",\n *   imageUrls: [\"data:image/png;base64,...\"]\n * });\n */\nexport const createPost = async postData => {\n  try {\n    // 1. æº–å‚™è¦å­˜å…¥ Firestore çš„è³‡æ–™\n    const newPost = {\n      title: postData.title,\n      content: postData.content,\n      boardName: postData.boardName,\n      authorId: postData.authorId,\n      authorName: postData.authorName,\n      imageUrls: postData.imageUrls || [],\n      createdAt: Timestamp.now(),\n      // ä½¿ç”¨ Firestore ä¼ºæœå™¨æ™‚é–“\n      commentCount: 0,\n      // åˆå§‹ç•™è¨€æ•¸ç‚º 0\n      comments: [] // åˆå§‹ç•™è¨€é™£åˆ—ç‚ºç©º\n    };\n\n    // 2. å°‡è³‡æ–™æ–°å¢åˆ° posts collection\n    // ğŸ”‘ é‡é»ï¼šaddDoc æœƒè‡ªå‹•ç”¢ç”Ÿä¸€å€‹å”¯ä¸€çš„ document ID\n    const docRef = await addDoc(collection(db, 'posts'), newPost);\n    console.log('âœ… è²¼æ–‡å·²æˆåŠŸæ–°å¢åˆ° Firestoreï¼ŒID:', docRef.id);\n\n    // 3. å›å‚³æ–°å»ºç«‹çš„æ–‡ä»¶ ID\n    return docRef.id;\n  } catch (error) {\n    console.error('âŒ æ–°å¢è²¼æ–‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    throw error; // å°‡éŒ¯èª¤å¾€ä¸Šæ‹‹ï¼Œè®“å‘¼å«çš„åœ°æ–¹å¯ä»¥è™•ç†\n  }\n};\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 3ï¼šæ›´æ–°è²¼æ–‡çš„ç•™è¨€\n// ==========================================\n/**\n * æ–°å¢ç•™è¨€åˆ°æŒ‡å®šçš„è²¼æ–‡\n *\n * @param {string} postId - è²¼æ–‡ ID\n * @param {object} comment - ç•™è¨€è³‡æ–™\n * @param {string} comment.author - ç•™è¨€è€…åç¨±\n * @param {string} comment.content - ç•™è¨€å…§å®¹\n * @returns {Promise<void>}\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * await addCommentToPost(\"abc123\", {\n *   author: \"å°è¯\",\n *   content: \"çœ‹èµ·ä¾†å¥½å¥½åƒï¼\"\n * });\n */\nexport const addCommentToPost = async (postId, comment) => {\n  try {\n    // 1. å–å¾—æŒ‡å®šè²¼æ–‡çš„åƒç…§\n    const postRef = doc(db, 'posts', postId);\n\n    // 2. å…ˆå–å¾—ç¾æœ‰çš„è²¼æ–‡è³‡æ–™ - ğŸ”¥ ä¿®æ­£ï¼šä½¿ç”¨ getDoc è€Œä¸æ˜¯ getDocs\n    const postSnapshot = await getDoc(postRef);\n    if (!postSnapshot.exists()) {\n      throw new Error('æ‰¾ä¸åˆ°æŒ‡å®šçš„è²¼æ–‡');\n    }\n    const postData = postSnapshot.data();\n    const existingComments = postData.comments || [];\n\n    // 3. æº–å‚™æ–°ç•™è¨€è³‡æ–™\n    const newComment = {\n      id: Date.now().toString(),\n      author: comment.author,\n      content: comment.content,\n      date: new Date().toLocaleString('zh-TW')\n    };\n\n    // 4. æ›´æ–°è²¼æ–‡ï¼šæ–°å¢ç•™è¨€ä¸¦å¢åŠ ç•™è¨€æ•¸é‡\n    // ğŸ”‘ é‡é»ï¼šupdateDoc åªæœƒæ›´æ–°æŒ‡å®šçš„æ¬„ä½ï¼Œä¸æœƒè¦†è“‹æ•´å€‹æ–‡ä»¶\n    await updateDoc(postRef, {\n      comments: [...existingComments, newComment],\n      commentCount: existingComments.length + 1\n    });\n    console.log('âœ… ç•™è¨€å·²æˆåŠŸæ–°å¢');\n  } catch (error) {\n    console.error('âŒ æ–°å¢ç•™è¨€æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    throw error;\n  }\n};\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 4ï¼šå–å¾—å–®ä¸€è²¼æ–‡ï¼ˆç”¨æ–¼è²¼æ–‡è©³æƒ…é ï¼‰\n// ==========================================\n/**\n * å–å¾—å–®ä¸€è²¼æ–‡çš„å®Œæ•´è³‡æ–™\n *\n * @param {string} postId - è²¼æ–‡ ID\n * @returns {Promise<object>} è²¼æ–‡è³‡æ–™\n */\nexport const getPostById = async postId => {\n  try {\n    // ğŸ”¥ ä¿®æ­£ï¼šç›´æ¥ä½¿ç”¨ doc åƒç…§ä¸¦ç”¨ getDoc å–å¾—\n    const postRef = doc(db, 'posts', postId);\n    const postSnapshot = await getDoc(postRef);\n    if (!postSnapshot.exists()) {\n      throw new Error('æ‰¾ä¸åˆ°æŒ‡å®šçš„è²¼æ–‡');\n    }\n    return {\n      id: postSnapshot.id,\n      ...postSnapshot.data()\n    };\n  } catch (error) {\n    console.error('âŒ å–å¾—è²¼æ–‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    throw error;\n  }\n};\n\n// ==========================================\n// ğŸ“ ä½¿ç”¨èªªæ˜ç¸½çµ\n// ==========================================\n/*\n\nåœ¨ React çµ„ä»¶ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š\n\nimport { listenToPosts, createPost, addCommentToPost } from '../services/postService';\nimport { useAuth } from '../contexts/AuthContext';\n\nfunction BoardTemplate({ boardName }) {\n  const [posts, setPosts] = useState([]);\n  const { currentUser, userProfile } = useAuth();\n\n  // 1. ç›£è½è²¼æ–‡ï¼ˆçµ„ä»¶è¼‰å…¥æ™‚ï¼‰\n  useEffect(() => {\n    const unsubscribe = listenToPosts(boardName, (newPosts) => {\n      setPosts(newPosts);\n    });\n\n    // æ¸…ç†å‡½æ•¸ï¼šçµ„ä»¶å¸è¼‰æ™‚åœæ­¢ç›£è½\n    return () => unsubscribe();\n  }, [boardName]);\n\n  // 2. æ–°å¢è²¼æ–‡\n  const handleSubmit = async (title, content, imageUrls) => {\n    try {\n      await createPost({\n        title,\n        content,\n        boardName,\n        authorId: currentUser.uid,\n        authorName: userProfile?.nickname || 'åŒ¿åç”¨æˆ¶',\n        imageUrls\n      });\n      // ä¸éœ€è¦æ‰‹å‹•æ›´æ–° posts stateï¼ŒonSnapshot æœƒè‡ªå‹•è§¸ç™¼ï¼\n    } catch (error) {\n      alert('ç™¼æ–‡å¤±æ•—ï¼š' + error.message);\n    }\n  };\n\n  // 3. æ–°å¢ç•™è¨€\n  const handleAddComment = async (postId, content) => {\n    try {\n      await addCommentToPost(postId, {\n        author: userProfile?.nickname || 'åŒ¿åç”¨æˆ¶',\n        content\n      });\n      // åŒæ¨£ä¸éœ€è¦æ‰‹å‹•æ›´æ–°ï¼ŒonSnapshot æœƒè‡ªå‹•è§¸ç™¼ï¼\n    } catch (error) {\n      alert('ç•™è¨€å¤±æ•—ï¼š' + error.message);\n    }\n  };\n\n  return (\n    // ... JSX\n  );\n}\n\n*/","map":{"version":3,"names":["collection","addDoc","getDocs","getDoc","query","where","orderBy","onSnapshot","doc","updateDoc","Timestamp","db","listenToPosts","boardName","callback","postsRef","q","unsubscribe","snapshot","posts","forEach","push","id","data","error","console","createPost","postData","newPost","title","content","authorId","authorName","imageUrls","createdAt","now","commentCount","comments","docRef","log","addCommentToPost","postId","comment","postRef","postSnapshot","exists","Error","existingComments","newComment","Date","toString","author","date","toLocaleString","length","getPostById"],"sources":["/Users/xueyulan/Desktop/IntroduceToTheInternet_FinalProject/src/services/postService.js"],"sourcesContent":["// src/services/postService.js\n// é€™å€‹æª”æ¡ˆå°ˆé–€è™•ç†è²¼æ–‡ç›¸é—œçš„ Firestore æ“ä½œ\n\nimport {\n  collection,      // ç”¨ä¾†æŒ‡å®šé›†åˆ\n  addDoc,          // æ–°å¢æ–‡ä»¶\n  getDocs,         // å–å¾—æ‰€æœ‰æ–‡ä»¶ï¼ˆä¸€æ¬¡æ€§ï¼‰\n  getDoc,          // ğŸ”¥ æ–°å¢ï¼šå–å¾—å–®ä¸€æ–‡ä»¶\n  query,           // å»ºç«‹æŸ¥è©¢\n  where,           // æŸ¥è©¢æ¢ä»¶\n  orderBy,         // æ’åº\n  onSnapshot,      // å³æ™‚ç›£è½è³‡æ–™è®ŠåŒ–\n  doc,             // æŒ‡å®šç‰¹å®šæ–‡ä»¶\n  updateDoc,       // æ›´æ–°æ–‡ä»¶\n  Timestamp        // Firestore æ™‚é–“æˆ³è¨˜\n} from 'firebase/firestore';\nimport { db } from '../firebase';\n\n// ==========================================\n// ğŸ“– åŸç†è§£èªªï¼š\n// ==========================================\n// Firestore çš„æ ¸å¿ƒæ“ä½œåˆ†ç‚ºå…©ç¨®ï¼š\n// 1. ã€Œä¸€æ¬¡æ€§è®€å–ã€ï¼šgetDocs() - åªå–å¾—ç•¶ä¸‹çš„è³‡æ–™\n// 2. ã€Œå³æ™‚ç›£è½ã€ï¼šonSnapshot() - è³‡æ–™æœ‰è®ŠåŒ–æ™‚è‡ªå‹•æ›´æ–°\n\n// æˆ‘å€‘æœƒä½¿ç”¨ onSnapshot()ï¼Œé€™æ¨£ç•¶å…¶ä»–ç”¨æˆ¶ç™¼æ–‡æ™‚\n// ä½ çš„ç•«é¢æœƒè‡ªå‹•å³æ™‚æ›´æ–°ï¼\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 1ï¼šå–å¾—æŒ‡å®šçœ‹æ¿çš„æ‰€æœ‰è²¼æ–‡ï¼ˆå³æ™‚ç›£è½ï¼‰\n// ==========================================\n/**\n * ç›£è½æŒ‡å®šçœ‹æ¿çš„è²¼æ–‡ï¼Œä¸¦åœ¨è³‡æ–™è®ŠåŒ–æ™‚å³æ™‚æ›´æ–°\n *\n * @param {string} boardName - çœ‹æ¿åç¨±ï¼ˆä¾‹å¦‚ \"Food\"ï¼‰\n * @param {function} callback - ç•¶è³‡æ–™è®ŠåŒ–æ™‚æœƒå‘¼å«é€™å€‹å‡½æ•¸ï¼Œå‚³å…¥æœ€æ–°çš„è²¼æ–‡é™£åˆ—\n * @returns {function} unsubscribe - å‘¼å«é€™å€‹å‡½æ•¸å¯ä»¥åœæ­¢ç›£è½\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * const unsubscribe = listenToPosts(\"Food\", (posts) => {\n *   console.log(\"æ”¶åˆ°æœ€æ–°è²¼æ–‡:\", posts);\n *   setPosts(posts); // æ›´æ–° React state\n * });\n *\n * // ç•¶çµ„ä»¶å¸è¼‰æ™‚ï¼Œåœæ­¢ç›£è½\n * return () => unsubscribe();\n */\nexport const listenToPosts = (boardName, callback) => {\n  try {\n    // 1. å»ºç«‹å° posts collection çš„åƒç…§\n    const postsRef = collection(db, 'posts');\n\n    // 2. å»ºç«‹æŸ¥è©¢ï¼šåªå–å¾—æŒ‡å®šçœ‹æ¿çš„è²¼æ–‡ï¼Œä¸¦æŒ‰æ™‚é–“æ’åºï¼ˆæ–°çš„åœ¨å‰ï¼‰\n    const q = query(\n      postsRef,\n      where('boardName', '==', boardName),  // ç¯©é¸æ¢ä»¶ï¼šçœ‹æ¿åç¨±\n      orderBy('createdAt', 'desc')          // æ’åºï¼šæœ€æ–°çš„åœ¨æœ€ä¸Šé¢\n    );\n\n    // 3. é–‹å§‹ç›£è½é€™å€‹æŸ¥è©¢\n    // ğŸ”‘ é‡é»ï¼šonSnapshot æœƒåœ¨ä»¥ä¸‹æƒ…æ³è§¸ç™¼ï¼š\n    //    - ç¬¬ä¸€æ¬¡å‘¼å«æ™‚ï¼ˆå›å‚³ç¾æœ‰è³‡æ–™ï¼‰\n    //    - æœ‰æ–°è²¼æ–‡æ–°å¢æ™‚\n    //    - æœ‰è²¼æ–‡è¢«ä¿®æ”¹æ™‚\n    //    - æœ‰è²¼æ–‡è¢«åˆªé™¤æ™‚\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const posts = [];\n\n      // 4. éæ­·æ‰€æœ‰æ–‡ä»¶ï¼Œå°‡è³‡æ–™è½‰æ›æˆæˆ‘å€‘éœ€è¦çš„æ ¼å¼\n      snapshot.forEach((doc) => {\n        posts.push({\n          id: doc.id,           // æ–‡ä»¶ ID\n          ...doc.data()         // æ–‡ä»¶å…§çš„æ‰€æœ‰è³‡æ–™\n        });\n      });\n\n      // 5. å‘¼å« callbackï¼ŒæŠŠæœ€æ–°è³‡æ–™å‚³å‡ºå»\n      callback(posts);\n    }, (error) => {\n      console.error('ç›£è½è²¼æ–‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n      // å¦‚æœç™¼ç”ŸéŒ¯èª¤ï¼Œå›å‚³ç©ºé™£åˆ—\n      callback([]);\n    });\n\n    // 6. å›å‚³å–æ¶ˆç›£è½çš„å‡½æ•¸\n    return unsubscribe;\n\n  } catch (error) {\n    console.error('è¨­å®šç›£è½æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    return () => {}; // å›å‚³ç©ºå‡½æ•¸é¿å…éŒ¯èª¤\n  }\n};\n\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 2ï¼šæ–°å¢è²¼æ–‡åˆ° Firestore\n// ==========================================\n/**\n * æ–°å¢ä¸€ç¯‡è²¼æ–‡åˆ° Firestore\n *\n * @param {object} postData - è²¼æ–‡è³‡æ–™\n * @param {string} postData.title - æ¨™é¡Œ\n * @param {string} postData.content - å…§å®¹\n * @param {string} postData.boardName - çœ‹æ¿åç¨±\n * @param {string} postData.authorId - ä½œè€… UID\n * @param {string} postData.authorName - ä½œè€…åç¨±\n * @param {array} postData.imageUrls - åœ–ç‰‡ç¶²å€é™£åˆ—\n * @returns {Promise<string>} å›å‚³æ–°å»ºç«‹çš„æ–‡ä»¶ ID\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * const newPostId = await createPost({\n *   title: \"ç¾å‘³åˆé¤\",\n *   content: \"ä»Šå¤©åƒäº†å¥½åƒçš„æ‹‰éºµ\",\n *   boardName: \"Food\",\n *   authorId: currentUser.uid,\n *   authorName: \"å°æ˜\",\n *   imageUrls: [\"data:image/png;base64,...\"]\n * });\n */\nexport const createPost = async (postData) => {\n  try {\n    // 1. æº–å‚™è¦å­˜å…¥ Firestore çš„è³‡æ–™\n    const newPost = {\n      title: postData.title,\n      content: postData.content,\n      boardName: postData.boardName,\n      authorId: postData.authorId,\n      authorName: postData.authorName,\n      imageUrls: postData.imageUrls || [],\n      createdAt: Timestamp.now(),      // ä½¿ç”¨ Firestore ä¼ºæœå™¨æ™‚é–“\n      commentCount: 0,                 // åˆå§‹ç•™è¨€æ•¸ç‚º 0\n      comments: []                     // åˆå§‹ç•™è¨€é™£åˆ—ç‚ºç©º\n    };\n\n    // 2. å°‡è³‡æ–™æ–°å¢åˆ° posts collection\n    // ğŸ”‘ é‡é»ï¼šaddDoc æœƒè‡ªå‹•ç”¢ç”Ÿä¸€å€‹å”¯ä¸€çš„ document ID\n    const docRef = await addDoc(collection(db, 'posts'), newPost);\n\n    console.log('âœ… è²¼æ–‡å·²æˆåŠŸæ–°å¢åˆ° Firestoreï¼ŒID:', docRef.id);\n\n    // 3. å›å‚³æ–°å»ºç«‹çš„æ–‡ä»¶ ID\n    return docRef.id;\n\n  } catch (error) {\n    console.error('âŒ æ–°å¢è²¼æ–‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    throw error; // å°‡éŒ¯èª¤å¾€ä¸Šæ‹‹ï¼Œè®“å‘¼å«çš„åœ°æ–¹å¯ä»¥è™•ç†\n  }\n};\n\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 3ï¼šæ›´æ–°è²¼æ–‡çš„ç•™è¨€\n// ==========================================\n/**\n * æ–°å¢ç•™è¨€åˆ°æŒ‡å®šçš„è²¼æ–‡\n *\n * @param {string} postId - è²¼æ–‡ ID\n * @param {object} comment - ç•™è¨€è³‡æ–™\n * @param {string} comment.author - ç•™è¨€è€…åç¨±\n * @param {string} comment.content - ç•™è¨€å…§å®¹\n * @returns {Promise<void>}\n *\n * ä½¿ç”¨ç¯„ä¾‹ï¼š\n * await addCommentToPost(\"abc123\", {\n *   author: \"å°è¯\",\n *   content: \"çœ‹èµ·ä¾†å¥½å¥½åƒï¼\"\n * });\n */\nexport const addCommentToPost = async (postId, comment) => {\n  try {\n    // 1. å–å¾—æŒ‡å®šè²¼æ–‡çš„åƒç…§\n    const postRef = doc(db, 'posts', postId);\n\n    // 2. å…ˆå–å¾—ç¾æœ‰çš„è²¼æ–‡è³‡æ–™ - ğŸ”¥ ä¿®æ­£ï¼šä½¿ç”¨ getDoc è€Œä¸æ˜¯ getDocs\n    const postSnapshot = await getDoc(postRef);\n\n    if (!postSnapshot.exists()) {\n      throw new Error('æ‰¾ä¸åˆ°æŒ‡å®šçš„è²¼æ–‡');\n    }\n\n    const postData = postSnapshot.data();\n    const existingComments = postData.comments || [];\n\n    // 3. æº–å‚™æ–°ç•™è¨€è³‡æ–™\n    const newComment = {\n      id: Date.now().toString(),\n      author: comment.author,\n      content: comment.content,\n      date: new Date().toLocaleString('zh-TW')\n    };\n\n    // 4. æ›´æ–°è²¼æ–‡ï¼šæ–°å¢ç•™è¨€ä¸¦å¢åŠ ç•™è¨€æ•¸é‡\n    // ğŸ”‘ é‡é»ï¼šupdateDoc åªæœƒæ›´æ–°æŒ‡å®šçš„æ¬„ä½ï¼Œä¸æœƒè¦†è“‹æ•´å€‹æ–‡ä»¶\n    await updateDoc(postRef, {\n      comments: [...existingComments, newComment],\n      commentCount: existingComments.length + 1\n    });\n\n    console.log('âœ… ç•™è¨€å·²æˆåŠŸæ–°å¢');\n\n  } catch (error) {\n    console.error('âŒ æ–°å¢ç•™è¨€æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    throw error;\n  }\n};\n\n\n// ==========================================\n// ğŸ”¹ åŠŸèƒ½ 4ï¼šå–å¾—å–®ä¸€è²¼æ–‡ï¼ˆç”¨æ–¼è²¼æ–‡è©³æƒ…é ï¼‰\n// ==========================================\n/**\n * å–å¾—å–®ä¸€è²¼æ–‡çš„å®Œæ•´è³‡æ–™\n *\n * @param {string} postId - è²¼æ–‡ ID\n * @returns {Promise<object>} è²¼æ–‡è³‡æ–™\n */\nexport const getPostById = async (postId) => {\n  try {\n    // ğŸ”¥ ä¿®æ­£ï¼šç›´æ¥ä½¿ç”¨ doc åƒç…§ä¸¦ç”¨ getDoc å–å¾—\n    const postRef = doc(db, 'posts', postId);\n    const postSnapshot = await getDoc(postRef);\n\n    if (!postSnapshot.exists()) {\n      throw new Error('æ‰¾ä¸åˆ°æŒ‡å®šçš„è²¼æ–‡');\n    }\n\n    return {\n      id: postSnapshot.id,\n      ...postSnapshot.data()\n    };\n\n  } catch (error) {\n    console.error('âŒ å–å¾—è²¼æ–‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);\n    throw error;\n  }\n};\n\n\n// ==========================================\n// ğŸ“ ä½¿ç”¨èªªæ˜ç¸½çµ\n// ==========================================\n/*\n\nåœ¨ React çµ„ä»¶ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š\n\nimport { listenToPosts, createPost, addCommentToPost } from '../services/postService';\nimport { useAuth } from '../contexts/AuthContext';\n\nfunction BoardTemplate({ boardName }) {\n  const [posts, setPosts] = useState([]);\n  const { currentUser, userProfile } = useAuth();\n\n  // 1. ç›£è½è²¼æ–‡ï¼ˆçµ„ä»¶è¼‰å…¥æ™‚ï¼‰\n  useEffect(() => {\n    const unsubscribe = listenToPosts(boardName, (newPosts) => {\n      setPosts(newPosts);\n    });\n\n    // æ¸…ç†å‡½æ•¸ï¼šçµ„ä»¶å¸è¼‰æ™‚åœæ­¢ç›£è½\n    return () => unsubscribe();\n  }, [boardName]);\n\n  // 2. æ–°å¢è²¼æ–‡\n  const handleSubmit = async (title, content, imageUrls) => {\n    try {\n      await createPost({\n        title,\n        content,\n        boardName,\n        authorId: currentUser.uid,\n        authorName: userProfile?.nickname || 'åŒ¿åç”¨æˆ¶',\n        imageUrls\n      });\n      // ä¸éœ€è¦æ‰‹å‹•æ›´æ–° posts stateï¼ŒonSnapshot æœƒè‡ªå‹•è§¸ç™¼ï¼\n    } catch (error) {\n      alert('ç™¼æ–‡å¤±æ•—ï¼š' + error.message);\n    }\n  };\n\n  // 3. æ–°å¢ç•™è¨€\n  const handleAddComment = async (postId, content) => {\n    try {\n      await addCommentToPost(postId, {\n        author: userProfile?.nickname || 'åŒ¿åç”¨æˆ¶',\n        content\n      });\n      // åŒæ¨£ä¸éœ€è¦æ‰‹å‹•æ›´æ–°ï¼ŒonSnapshot æœƒè‡ªå‹•è§¸ç™¼ï¼\n    } catch (error) {\n      alert('ç•™è¨€å¤±æ•—ï¼š' + error.message);\n    }\n  };\n\n  return (\n    // ... JSX\n  );\n}\n\n*/\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}